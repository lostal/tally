---
const items = ['Escanear', 'Seleccionar', 'Pagar', 'Listo'];
---

<section class="bg-cream overflow-hidden border-y border-stone-300 py-12">
  <div class="marquee-container" id="marquee-section">
    <div class="marquee-content" id="marquee-track">
      {
        [...Array(6)].map(() =>
          items.map((item) => (
            <>
              <span class="text-title text-muted whitespace-nowrap">{item}</span>
              <span class="text-title text-stone-300">â€¢</span>
            </>
          ))
        )
      }
    </div>
  </div>
</section>

<style>
  .marquee-container {
    display: flex;
    overflow: hidden;
    user-select: none;
    gap: 0;
  }

  .marquee-content {
    display: flex;
    gap: clamp(2rem, 5vw, 5rem);
    flex-shrink: 0;
    min-width: 100%;
    will-change: transform;
  }

  @media (prefers-reduced-motion: reduce) {
    .marquee-content {
      animation: none;
    }
  }
</style>

<script>
  import gsap from 'gsap';
  gsap.registerPlugin(ScrollTrigger);

  const track = document.getElementById('marquee-track');
  const section = document.getElementById('marquee-section');

  if (track && section) {
    let currentAnimation: gsap.core.Timeline | null = null;

    const createAnimation = (direction: 'left' | 'right') => {
      const anim = gsap.to(track, {
        xPercent: direction === 'left' ? -50 : 50,
        duration: 25,
        ease: 'none',
        repeat: -1,
      });
      return anim;
    };

    currentAnimation = createAnimation('left');

    ScrollTrigger.create({
      trigger: section,
      start: 'top bottom',
      end: 'bottom top',
      onUpdate: (self: ScrollTrigger) => {
        const velocity = self.getVelocity();

        if (velocity < -50) {
          if (currentAnimation) currentAnimation.kill();
          currentAnimation = createAnimation('right');
        } else if (velocity > 50) {
          if (currentAnimation) currentAnimation.kill();
          currentAnimation = createAnimation('left');
        }
      },
      onLeave: () => {
        if (currentAnimation) {
          currentAnimation.kill();
        }
        currentAnimation = createAnimation('left');
      },
      onEnterBack: () => {
        if (currentAnimation) {
          currentAnimation.kill();
        }
        currentAnimation = createAnimation('left');
      },
    });
  }
</script>
